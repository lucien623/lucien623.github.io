<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>关于PendingIntent数据重复问题 | Lucien</title><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/5.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">关于PendingIntent数据重复问题</h1><a id="logo" href="/.">Lucien</a><p class="description"></p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div id="layout" class="pure-g"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">关于PendingIntent数据重复问题</h1><div class="post-meta">Nov 12, 2020<span> | </span><span class="category"><a href="/categories/技术/">技术</a></span><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> Hits</span></span></div><div class="post-content"><p>之前在测试推送的过程中发现了一个很奇怪的问题，就是当收到多条推送时，点击推送获取的到的数据都是第一条推送的，经过查找之后，发现了该问题的原因。接下来一段就是来自官网的描述</p>
<blockquote>
<p>A PendingIntent itself is simply a reference to a token maintained by the system describing the original data used to retrieve it. This means that, even if its owning application’s process is killed, the PendingIntent itself will remain usable from other processes that have been given it. If the creating application later re-retrieves the same kind of PendingIntent (same operation, same Intent action, data, categories, and components, and same flags), it will receive a PendingIntent representing the same token if that is still valid, and can thus call cancel() to remove it.<br>Because of this behavior, it is important to know when two Intents are considered to be the same for purposes of retrieving a PendingIntent. <strong>A common mistake people make is to create multiple PendingIntent objects with Intents that only vary in their “extra” contents, expecting to get a different PendingIntent each time.</strong> This does not happen. The parts of the Intent that are used for matching are the same ones defined by Intent#filterEquals(Intent). If you use two Intent objects that are equivalent as per Intent#filterEquals(Intent), then you will get the same PendingIntent for both of them.</p>
</blockquote>
<p>加粗部分的意思是说，如果<code>PendingIntent</code>只有在<code>Intent</code>中的<code>extra</code>不同的话，那么<code>PendingIntent</code>只会拿到相同的，即第一次的那个，所以问题就出现在这里，官方给了两种这个情况的解决方案</p>
<blockquote>
<p>If you truly need multiple distinct PendingIntent objects active at the same time (such as to use as two notifications that are both shown at the same time), then you will need to ensure there is something that is different about them to associate them with different PendingIntents. This may be any of the Intent attributes considered by Intent#filterEquals(Intent), or different request code integers supplied to getActivity(Context, int, Intent, int), getActivities(Context, int, Intent[], int), getBroadcast(Context, int, Intent, int), or getService(Context, int, Intent, int).<br>If you only need one PendingIntent active at a time for any of the Intents you will use, then you can alternatively use the flags FLAG_CANCEL_CURRENT or FLAG_UPDATE_CURRENT to either cancel or modify whatever current PendingIntent is associated with the Intent you are supplying.</p>
</blockquote>
<p>第一种方式就是给<code>Intent</code>设置不同的<code>filter</code>或者<code>request code</code>；第二种方式是如果不需要多个<code>PendingIntent</code>，那么可以在<code>flags</code>参数中传入<code>FLAG_CANCEL_CURRENT</code>或者<code>FLAG_UPDATE_CURRENT</code>将<code>PendingIntent</code>更新为最新的那个。因为我这边的情形是需要保留所有的不同的<code>PendingIntent</code>，所以采用了第一种方式，问题解决。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a data-url="http://yoursite.com/2020/11/12/关于PendingIntent数据重复问题/" data-id="ckx4hkt2g001e2ls6c2gih91a" class="article-share-link">分享到</a><div class="tags"><a href="/tagsß/android/">android</a></div><div class="post-nav"><a href="/2020/05/26/Flutter-更新失败问题/" class="next">Flutter 更新失败问题</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank" class="search-form"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://yoursite.com"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/生活/">生活</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tagsß/android/" style="font-size: 15px;">android</a> <a href="/tagsß/Java/" style="font-size: 15px;">Java</a> <a href="/tagsß/Flutter/" style="font-size: 15px;">Flutter</a> <a href="/tagsß/database/" style="font-size: 15px;">database</a> <a href="/tagsß/DSA/" style="font-size: 15px;">DSA</a> <a href="/tagsß/设计模式/" style="font-size: 15px;">设计模式</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/11/12/关于PendingIntent数据重复问题/">关于PendingIntent数据重复问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/05/26/Flutter-更新失败问题/">Flutter 更新失败问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/11/mac中修改host的方法/">mac中修改host的方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/26/重拾-DSA-之二叉搜索树/">重拾 DSA 之二叉搜索树</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/24/ARouter原理探析/">ARouter原理探析</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/22/ThreadLocal简析/">ThreadLocal简析</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/21/重拾-DSA-排序算法之堆排序/">重拾 DSA 排序算法之堆排序</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/20/Java线程池ThreadPoolExecutor介绍/">Java线程池ThreadPoolExecutor介绍</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/19/ButterKnife原理探析/">ButterKnife原理探析</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/10/18/OkHttp原理探析/">OkHttp原理探析</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://zhoukekestar.github.io/" title="zhoukekestar" target="_blank">zhoukekestar</a><ul></ul><a href="https://github.com/EastWoodYang" title="EastWood Yang" target="_blank">EastWood Yang</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">© <a href="/." rel="nofollow">Lucien.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a id="rocket" href="#top" class="show"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="/css/jquery.fancybox.css?v=0.0.0"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create','UA-88576409-1','auto');ga('send','pageview');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>